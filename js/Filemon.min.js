/**
 * Filemon JS - The JavaScript File Manager
 * 
 * This file contains all JavaScript code for Filemon JS
 * 
 * Filemon JS : The JavaScript File Manager <http://mobilegb.eu/filemon>
 * Copyright (c) 2011, Grzegorz Bednarz
 * 
 * Author: Grzegorz Bednarz
 * 
 * Filemon JS is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 or
 * GNU Lesser General Public License version 3 as published by
 * the Free Software Foundation.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License or GNU Lesser General Public License 
 * for more details.
 *
 * You should have received a copy of the GNU General Public License and
 * GNU Lesser General Public License along with this program; if not, 
 * write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, 
 * Boston, MA 02110-1301 USA
 * 
 * Redistributions of files must retain the above copyright notice.
 * 
 * @author Grzegorz Bednarz
 * @copyright Copyright (c) 2011, Grzegorz Bednarz
 * @link http://mobilegb.eu/filemon
 * @version 1.0.0
 * @package Filemon
 */

Ext.namespace("Filemon","Filemon.lang","Filemon.util");if(!Filemon.lang.translations){Filemon.lang.translations={}}Filemon.lang.translate=function(a){if(Filemon.lang.translations[a]){return Filemon.lang.translations[a]}return a};Filemon.getApi=function(a,b){if(a[b]){return a[b]}return a.defaultLink.replace(":action",b)};Filemon.Panel=function(a){a=a||{};Ext.applyIf(a,{multiSelect:true,allowDirSelect:true,allowPreview:true,curDir:"/",filter:"",height:300,iconsPath:"filemon/images/"});if(!a.api){throw"Please provide API configuration"}Ext.apply(a,{layout:"border"});Filemon.Panel.superclass.constructor.call(this,a)};Ext.extend(Filemon.Panel,Ext.Panel,{initComponent:function(){var a=this;this.addEvents("filedblclicked");this.dirTree=new Ext.tree.TreePanel({title:Filemon.lang.translate("Directory tree"),ctCls:"filemon-dir-tree",animate:true,containerScroll:true,enableDD:true,ddGroup:"filemonDD",autoScroll:true,rootVisible:true,loader:new Ext.tree.TreeLoader({dataUrl:Filemon.getApi(this.api,"list-folders")}),root:new Ext.tree.AsyncTreeNode({text:"/",allowDrag:false,id:"/",cls:"dir-tree-folder"}),region:"west",collapsible:true,split:true,minWidth:130,width:160,dropConfig:{ddGroup:"filemonDD",appendOnly:true,onNodeDrop:function(c,b,j,g){var k=[];var h=c.node.attributes.id;var l=false;if(g.filesDrag){var d=a.filesView.getRecords(g.nodes);for(var f in d){if(!d[f].data){continue}if(Filemon.util.checkMovePath(d[f].data.path,h)){if(d[f].data.dir){l=true}k.push(d[f].data.path)}}}else{if(Filemon.util.checkMovePath(g.node.attributes.id,h)){l=true;k.push(g.node.attributes.id)}}if(k.length==0){return false}a.moveFiles(k,h,l);return true}}});this.dirTree.on("click",function(b){a.changeDir(b.attributes.id)});this.filesView=new Ext.DataView({store:new Ext.data.JsonStore({url:Filemon.getApi(this.api,"list-files"),fields:["icon","name","dir","path","writable","size","width","height",{name:"shortName",mapping:"name",convert:Filemon.util.cropFileName}],baseParams:{filter:this.filter},autoLoad:true,listeners:{load:function(){a.filesView.removeListener("render",a.filesView.plugins.onRender);a.filesView.removeListener("containerclick",a.filesView.plugins.cancelClick);a.filesView.plugins=new Ext.DataView.DragSelector({dragSafe:true});a.filesView.plugins.init(a.filesView);a.filesView.plugins.onRender(a.filesView)}}}),tpl:new Ext.XTemplate('<tpl for=".">','<div class="filemon-file-wrap<tpl if="dir"> filemon-directory</tpl>">','<div class="filemon-thumb">',"<tpl if=\"icon == 'custom'\">",'<img src="'+Filemon.getApi(this.api,"print-thumbnail")+(Filemon.getApi(this.api,"print-thumbnail").indexOf("?")!=-1?"&":"?")+'file={path}" class="filemon-thumb-img" alt="{name}" title="{name}" />',"</tpl>","<tpl if=\"icon != 'custom'\">",'<img src="'+this.iconsPath+'{icon}.png" class="filemon-thumb-img" alt="{name}" title="{name}" />',"</tpl>",'<tpl if="!writable"><img src="'+this.iconsPath+'lock.png" alt="lock" style="position: absolute; top: 5px; left: 5px;" /></tpl>',"</div>",'<span class="filemon-filename">{shortName}</span>',"</div>","</tpl>"),itemSelector:".filemon-file-wrap",overClass:"filemon-file-over",selectedClass:"filemon-file-selected",multiSelect:this.multiSelect,singleSelect:!this.multiSelect,listeners:{render:function(){new Filemon.FileDragZone(this,{containerScroll:true,ddGroup:"filemonDD"});new Filemon.FileDropZone(a,{ddGroup:"filemonDD"})}},plugins:new Ext.DataView.DragSelector({dragSafe:true})});this.filesView.on("dblclick",function(f,b){var e=f.store.getAt(b);if(e.data.dir){a.changeDir(e.data.path)}else{if(a.allowPreview){var d=e.data.name.lastIndexOf(".");if(d>0){var c=e.data.name.substring(d+1).toLowerCase();if(c=="jpg"||c=="jpeg"||c=="png"||c=="gif"){a.showImagePreview(e.data)}else{if(c=="txt"||c=="css"||c=="html"||c=="ini"){a.showTextPreview(e.data)}}}}a.fireEvent("filedblclicked",e.data)}});this.rightClickMenu=new Ext.menu.Menu({items:[{iconCls:"filemon-menu-rename",text:Filemon.lang.translate("Rename"),handler:function(){if(a.filesView.getSelectionCount()==0){return}var b=a.filesView.getSelectedRecords()[0];a.showFileNameWindow(b.data.name,"Enter a new name for file / directory",function(c,d){d.loadMask.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"rename-file"),params:{newName:c,oldName:b.data.path},success:function(e){d.loadMask.hide();var f=Ext.decode(e.responseText);if(f.success){a.filesView.store.reload();if(b.data.dir){a.dirTree.root.reload()}d.hide()}else{Filemon.util.error("Unable to rename file",f.errorMsg)}},failure:function(e){d.loadMask.hide();Filemon.util.connectionError()}})})}},{iconCls:"filemon-menu-remove",text:Filemon.lang.translate("Delete"),handler:function(){if(a.filesView.getSelectionCount()==0){return}var b;if(a.filesView.getSelectionCount()==1){b=String.format(Filemon.lang.translate("Delete {0}?"),a.filesView.getSelectedRecords()[0].data.name)}else{b=Filemon.lang.translate("Delete selected files?")}Ext.MessageBox.confirm(Filemon.lang.translate("Are you sure?"),b,function(f){if(f=="yes"){var g=[];var d=a.filesView.getSelectedRecords();var c=false;for(var e in d){if(!d[e].data){continue}if(d[e].data.dir){c=true}g.push(d[e].data.path)}a.mask.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"delete"),params:{files:Ext.encode(g)},success:function(h){a.mask.hide();var l=Ext.decode(h.responseText);if(l.success){a.filesView.store.reload();if(c){a.dirTree.root.reload()}}else{var k='<ul class="filemon-error-files-list">';for(var j in l.errorFiles){if(typeof l.errorFiles[j]=="string"){k+="<li>"+l.errorFiles[j]+"</li>"}}k+="</ul>";var m=new Ext.Window({layout:"anchor",bodyStyle:"padding:5px;",iconCls:"filemon-win-error",width:450,height:230,title:Filemon.lang.translate("Failed to delete files"),modal:true,items:[{bodyStyle:"background-color: transparent;",html:'<div class="x-window-dlg"><div class="ext-mb-icon ext-mb-error"></div><div class="ext-mb-content"><div class="ext-mb-text" style="text-align: left;">'+Filemon.lang.translate("Below is a list of files which could not be removed:")+"</div></div></div>",height:50,border:false},{anchor:"-, -50",autoScroll:true,bodyStyle:"text-align: left; padding: 5px;",html:k}]});m.show();a.filesView.store.reload();if(c){a.dirTree.root.reload()}}},failure:function(h){a.mask.hide();Filemon.util.connectionError()}})}})}},{text:Filemon.lang.translate("Properties"),iconCls:"filemon-menu-properties",handler:function(){if(a.filesView.getSelectionCount()==0){return}var b=a.filesView.getSelectedRecords();var d=[];for(var c in b){if(!b[c].data){continue}d.push(b[c].data.path)}a.mask.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"properties"),params:{files:Ext.encode(d)},success:function(f){a.mask.hide();var h=Ext.decode(f.responseText);var l={size:Filemon.lang.translate("Size"),mtime:Filemon.lang.translate("Modification date"),ctime:Filemon.lang.translate("Creation date"),width:Filemon.lang.translate("Width"),height:Filemon.lang.translate("Height"),fileCount:Filemon.lang.translate("Number of files"),dirCount:Filemon.lang.translate("Number of directories")};var j=[];for(var g in h){if(g!="icon"&&g!="type"&&g!="filename"){if(g=="size"){j.push([l[g],Ext.util.Format.fileSize(h[g])])}else{j.push([l[g],h[g]])}}}var e=new Ext.data.Store({data:j,reader:new Ext.data.ArrayReader({},["name","value"])});var k=new Ext.Window({title:Filemon.lang.translate("Properties"),iconCls:"filemon-win-properties",resizable:false,items:[{bodyStyle:"background-color: transparent; text-align: center;",border:false,html:'<div class="filemon-thumb"><img src="'+((h.icon=="custom")?Filemon.getApi(a.api,"print-thumbnail")+(Filemon.getApi(a.api,"print-thumbnail").indexOf("?")!=-1?"&":"?")+"file="+a.curDir+h.filename:(a.iconsPath+h.icon+".png"))+'" class="filemon-thumb-img" /></div>'},{bodyStyle:"background-color: transparent; text-align: center;",border:false,html:h.filename!=undefined?h.filename:"&nbsp;"},new Ext.grid.GridPanel({store:e,autoHeight:true,width:250,columns:[{header:"",dataIndex:"name",width:125},{header:"",dataIndex:"value",width:125}]})]});k.show()},failure:function(e){a.mask.hide();Filemon.util.connectionError()}})}}]});this.filesView.on("contextmenu",function(b,c,e,d){if(!b.isSelected(e)){b.select(e)}a.rightClickMenu.showAt(d.getXY());d.stopEvent();return false});this.filesView.on("click",function(b,c,e,d){if(d.type=="mousedown"&&d.button==2){b.fireEvent("contextmenu",b,c,e,d)}});this.filesPanel=new Ext.Panel({title:this.curDir,region:"center",layout:"fit",autoScroll:true,items:[this.filesView],tbar:[{iconCls:"filemon-tb-up",text:Filemon.lang.translate("Up"),handler:function(){var c=a.curDir;var b=c.substring(0,c.lastIndexOf("/"));if(b==""){b="/"}a.changeDir(b)}},"|",{iconCls:"filemon-tb-new-file",text:Filemon.lang.translate("New"),menu:[{iconCls:"filemon-tb-new-folder",text:Filemon.lang.translate("New folder"),handler:function(){a.showFileNameWindow("","Enter a name for the new folder",function(b,c){c.loadMask.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"create-dir"),params:{dirName:b,path:a.curDir},success:function(d){c.loadMask.hide();var e=Ext.decode(d.responseText);if(e.success){a.filesView.store.reload();a.dirTree.root.reload();c.hide()}else{Filemon.util.error("Unable to create directory",e.errorMsg)}},failure:function(d){c.loadMask.hide();Filemon.util.connectionError()}})})}},{text:Filemon.lang.translate("New file"),iconCls:"filemon-tb-new-file",handler:function(){a.showFileNameWindow(Filemon.lang.translate("unnamed.txt"),"Enter a name for the new file",function(b,c){c.loadMask.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"create-file"),params:{fileName:b,path:a.curDir},success:function(d){c.loadMask.hide();var e=Ext.decode(d.responseText);if(e.success){a.filesView.store.reload();c.hide()}else{Filemon.util.error("Unable to create file",e.errorMsg)}},failure:function(d){c.loadMask.hide();Filemon.util.connectionError()}})})}}]},{xtype:"browsebutton",iconCls:"filemon-tb-upload",text:Filemon.lang.translate("Upload file"),inputFileName:"uploadFile",handler:function(c){var e=document.createElement("form");var d=c.detachInputFile().dom;e.appendChild(d);e.style.display="none";document.body.appendChild(e);var b=new Ext.form.BasicForm(e,{fileUpload:true,url:Filemon.getApi(a.api,"upload-file"),baseParams:{path:a.curDir}});a.mask.show();b.submit({success:function(){document.body.removeChild(e);window.setTimeout(function(){a.mask.hide();a.filesView.store.reload()},1000)},failure:function(h,g){a.mask.hide();document.body.removeChild(e);if(g.result.errorMsg!=""){Filemon.util.error("Failed to upload file",g.result.errorMsg)}else{Filemon.util.error("Error","Failed to upload file")}}})}},{iconCls:"filemon-tb-download",text:Filemon.lang.translate("Download files"),handler:function(){if(a.filesView.getSelectionCount()==0){return}var f;if(a.filesView.getSelectionCount()==1){f={files:a.filesView.getSelectedRecords()[0].data.path}}else{f={};var c=a.filesView.getSelectedRecords();for(var d=0;d<c.length;d++){f["files["+d+"]"]=c[d].data.path}}var e=document.createElement("form");e.style.display="none";document.body.appendChild(e);var b=new Ext.form.BasicForm(e,{fileUpload:true,url:Filemon.getApi(a.api,"download"),baseParams:f});b.submit({success:function(){document.body.removeChild(e)},failure:function(){document.body.removeChild(e);Filemon.util.error("Error","Failed to download file")}})}},"|",{iconCls:"filemon-tb-refresh",text:Filemon.lang.translate("Refresh"),handler:function(){a.dirTree.root.reload();a.filesView.store.reload()}},"->",{iconCls:"filemon-tb-info",handler:function(){var b=new Ext.Window({title:Filemon.lang.translate("About"),width:180,iconCls:"filemon-win-info",height:260,resizable:false,bodyStyle:"padding: 5px; text-align: center; background-color: white;",html:'<img src="'+a.iconsPath+'icon.png" alt="Filemon JS" /><div style="font-size: large;">Filemon JS</div><div style="color: grey;">'+Filemon.lang.translate("version")+" "+Filemon.version+'</div><div style="padding-top: 15px;">'+Filemon.lang.translate("author")+': Grzegorz Bednarz</div><div><a href="http://mobilegb.eu" target="_blank">http://mobilegb.eu</a></div>'});b.show()}}]});this.items=[this.dirTree,this.filesPanel];Filemon.Panel.superclass.initComponent.call(this)},changeDir:function(a){this.filesPanel.setTitle(a);this.filesView.store.baseParams.path=a;this.curDir=a;this.filesView.store.reload()},showTextPreview:function(b){var a=this;this.mask.show();Ext.Ajax.request({url:Filemon.getApi(this.api,"print-file"),params:{file:b.path},success:function(c){a.mask.hide();var d;if(b.writable){var e=new Ext.form.TextArea({value:c.responseText});d=new Ext.Window({title:b.name,filePath:b.path,width:700,iconCls:"filemon-win-edit",height:500,layout:"fit",maximizable:true,items:[e],tbar:[{text:Filemon.lang.translate("Save"),iconCls:"filemon-tb-save",handler:function(g){var f=new Ext.LoadMask(d.getId(),{removeMask:true});f.show();Ext.Ajax.request({url:Filemon.getApi(a.api,"save-file"),params:{file:b.path,content:e.getValue()},success:function(h){f.hide();var i=Ext.decode(h.responseText);if(!i.success){Filemon.util.error("Unable to save file",i.errorMsg)}},failure:function(h){f.hide();Filemon.util.connectionError()}})}}]});d.show()}else{d=new Ext.Window({title:b.name,width:700,height:500,layout:"fit",iconCls:"filemon-win-edit",maximizable:true,items:[{xtype:"textarea",value:c.responseText,readOnly:true}]});d.show()}},failure:function(c){a.mask.hide();Filemon.util.connectionError()}})},showImagePreview:function(c){var a,b;if(c.width<100){a=100}else{if(c.width>800){a=800}else{a=c.width}}if(c.height<100){b=100}else{if(c.height>700){b=700}else{b=c.height}}var d=new Ext.Window({title:c.name,width:a,height:b,maximizable:true,iconCls:"filemon-win-image",autoScroll:true,html:'<img src="'+Filemon.getApi(this.api,"print-file")+(Filemon.getApi(this.api,"print-file").indexOf("?")!=-1?"&":"?")+"file="+c.path+'" width="'+c.width+'" height="'+c.height+'" alt="'+c.name+'" />'});d.show()},showFileNameWindow:function(c,d,a){if(!this.fileNameWindow){var b=this;this.fileNameWindow=new Ext.Window({layout:"fit",bodyStyle:"padding:5px;",iconCls:"filemon-win-edit",width:400,autoHeight:true,closeAction:"hide",modal:true,items:new Ext.FormPanel({labelWidth:40,defaultType:"textfield",baseCls:"x-plain",items:[{fieldLabel:Filemon.lang.translate("Name"),anchor:"100%",name:"fileName",vtype:"fileName",listeners:{specialkey:function(e,f){if(f.getKey()==f.ENTER){b.fileNameWindow.buttons[0].handler.call(b)}}}}]}),buttons:[{text:Filemon.lang.translate("Send"),scope:this,handler:function(){var e=this.fileNameWindow.items.items[0].getForm().findField("fileName").getValue();if(Filemon.util.checkFilename(e)){this.fileNameWindow.handler(e,this.fileNameWindow)}}},{text:Filemon.lang.translate("Cancel"),scope:this,handler:function(){this.fileNameWindow.hide()}}],listeners:{show:function(){if(!this.loadMask){this.loadMask=new Ext.LoadMask(this.getId())}}}})}this.fileNameWindow.handler=a;this.fileNameWindow.setTitle(Filemon.lang.translate(d));this.fileNameWindow.show();this.fileNameWindow.items.items[0].getForm().findField("fileName").setValue(c);return this.fileNameWindow},moveFiles:function(c,d,a){var b=this;this.mask.show();Ext.Ajax.request({url:Filemon.getApi(this.api,"move-files"),params:{destination:d,files:Ext.encode(c)},success:function(e){b.mask.hide();var f=Ext.decode(e.responseText);if(f.success){b.filesView.store.reload();if(a){b.dirTree.root.reload()}}else{Filemon.util.error("Unable to move files",f.errorMsg)}},failure:function(e){b.mask.hide();Filemon.util.connectionError()}})},getSelectedFiles:function(){var c=[];var b=this.getSelectedData();for(var a in b){if(b[a].path){c.push(b[a].path)}}return c},getSelectedData:function(){var c=[];var b=this.filesView.getSelectedRecords();for(var a in b){if(!b[a].data){continue}if(!this.allowDirSelect&&b[a].data.dir){continue}c.push(b[a].data)}return c},onRender:function(a,b){Filemon.Panel.superclass.onRender.call(this,a,b);this.mask=new Ext.LoadMask(this.getId(),{store:this.filesView.store});this.dirTree.root.expand()}});Filemon.Window=function(a){a=a||{};Ext.applyIf(a,{multiSelect:true,allowDirSelect:true,allowPreview:false,curDir:"/",filter:"",iconsPath:"filemon/images/",iconCls:"filemon-win-default-icon",title:Filemon.lang.translate("Select a file")});if(!a.api){throw"Please provide API configuration"}Ext.apply(a,{layout:"fit"});Filemon.Window.superclass.constructor.call(this,a)};Ext.extend(Filemon.Window,Ext.Window,{initComponent:function(){var a=this;this.addEvents("filesselected");this.panel=new Filemon.Panel({multiSelect:this.multiSelect,allowDirSelect:this.allowDirSelect,allowPreview:this.allowPreview,curDir:this.curDir,filter:this.filter,iconsPath:this.iconsPath,api:this.api,border:false,listeners:{filedblclicked:function(c){if(!a.allowPreview){var b=[c.path];a.fireEvent("filesselected",a,b)}}}});this.items=[this.panel];this.buttons=[{text:Filemon.lang.translate("Select"),handler:function(){var b=a.panel.getSelectedFiles();if(b.length==0){Filemon.util.error("No file selected","Please select a file")}else{a.fireEvent("filesselected",a,b)}}},{text:Filemon.lang.translate("Cancel"),handler:function(){if(a.closeAction=="hide"){a.hide()}else{a.close()}}}];Filemon.Panel.superclass.initComponent.call(this)},getSelectedFiles:function(){return this.panel.getSelectedFiles()},getSelectedData:function(){return this.panel.getSelectedData()}});Filemon.FileDragZone=function(a,b){this.view=a;Filemon.FileDragZone.superclass.constructor.call(this,a.getEl(),b)};Ext.extend(Filemon.FileDragZone,Ext.dd.DragZone,{getDragData:function(h){var g=h.getTarget(".filemon-file-wrap");if(g){var c=this.view;if(!c.isSelected(g)){c.onClick(h)}var b=c.getSelectedNodes();var f={nodes:b,filesDrag:true};if(b.length==1){f.ddel=g.firstChild.firstChild;f.single=true}else{var j=document.createElement("div");j.className="filemon-multi-proxy";for(var d=0,a=b.length;d<a;d++){j.appendChild(b[d].firstChild.firstChild.cloneNode(true));if((d+1)%3==0){j.appendChild(document.createElement("br"))}}f.ddel=j;f.multi=true}return f}return false},afterRepair:function(){for(var b=0,a=this.dragData.nodes.length;b<a;b++){Ext.fly(this.dragData.nodes[b]).frame("#8db2e3",1)}this.dragging=false},getRepairXY:function(b){if(!this.dragData.multi){var a=Ext.Element.fly(this.dragData.ddel).getXY();a[0]+=3;a[1]+=3;return a}return false}});Filemon.FileDropZone=function(a,b){this.panel=a;Filemon.FileDropZone.superclass.constructor.call(this,a.filesView.getEl(),b)};Ext.extend(Filemon.FileDropZone,Ext.dd.DropZone,{getTargetFromEvent:function(c){var b=c.getTarget(".filemon-directory");if(b){var a=this.panel.filesView;if(a.isSelected(b)){return false}return{ddel:b,dropData:a.getRecord(b)}}return false},onNodeDrop:function(b,a,h,f){var j=[];var g=b.dropData.data.path;var k=false;if(f.filesDrag){var c=this.panel.filesView.getRecords(f.nodes);for(var d in c){if(!c[d].data){continue}if(Filemon.util.checkMovePath(c[d].data.path,g)){if(c[d].data.dir){k=true}j.push(c[d].data.path)}}}else{if(Filemon.util.checkMovePath(f.node.attributes.id,g)){k=true;j.push(f.node.attributes.id)}}if(j.length==0){return false}this.panel.moveFiles(j,g,k);return true}});Filemon.util.cropFileName=function(a){if(a.length>12){return a.substr(0,9)+"..."}return a};Filemon.util.error=function(b,a){Ext.MessageBox.show({title:Filemon.lang.translate(b),msg:Filemon.lang.translate(a),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})};Filemon.util.connectionError=function(){Filemon.util.error("Unable to connect to the server","Can't connect to the server. Please try again later.")};Filemon.util.checkFilename=function(a){if(a==""){Filemon.util.error("Name is empty","Enter name of the file / directory");return false}var b=/[\/\\\?%\*:|"'<>]/;if(b.test(a)){Filemon.util.error("Name contains illegal characters","The name of the file / directory may not contain the following characters: / \\ ? % * : | \" ' < >");return false}if(a.charAt(0)=="."){Filemon.util.error("Name contains illegal characters","The name of the file / directory may not start with a dot");return false}return true};Filemon.util.checkMovePath=function(b,a){return a.indexOf(b)!==0};Ext.form.VTypes.fileNameVal=/[^\/\\\?%\*:|"'<>]/;Ext.form.VTypes.fileNameMask=/[^\/\\\?%\*:|"'<>]/;Ext.form.VTypes.fileNameText=Filemon.lang.translate("Invalid file name");Ext.form.VTypes.fileName=function(a){return Ext.form.VTypes.fileNameVal.test(a)&&a.charAt(0)!="."};Filemon.version="1.0.0";Ext.reg("filemonpanel",Filemon.Panel);